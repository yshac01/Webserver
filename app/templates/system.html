{% extends "base.html" %}
{% block title %}System Monitor{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-5">
    <h1 class="mb-0">System Monitor</h1>
    <div class="badge bg-primary bg-opacity-10 text-primary p-2">Live Data</div>
</div>

<div class="row g-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span class="text-light">CPU Usage</span>
                <span id="cpu-percent" class="fw-bold text-light">0%</span>
            </div>
            <div class="card-body">
                <div class="progress">
                    <div id="cpu-usage" class="progress-bar" role="progressbar" style="width: 0%"></div>
                </div>
                <div class="mt-3">
                    <div class="d-flex justify-content-between">
                        <span class="text-muted">Cores:</span>
                        <span id="cpu-cores" class="text-light">0</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="text-muted">Temperature:</span>
                        <span id="cpu-temp" class="text-light">0°C</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span class="text-light">Memory Usage</span>
                <span id="memory-percent" class="fw-bold text-light">0%</span>
            </div>
            <div class="card-body">
                <div class="progress">
                    <div id="memory-usage" class="progress-bar" role="progressbar" style="width: 0%"></div>
                </div>
                <div class="mt-3">
                    <div class="d-flex justify-content-between">
                        <span class="text-muted">Used:</span>
                        <span id="memory-used" class="text-light">0 MB</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="text-muted">Available:</span>
                        <span id="memory-available" class="text-light">0 MB</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">

    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header text-light">
                Disk Usage
            </div>
            <div class="card-body">
                <div class="progress mb-3">
                    <div id="disk-usage" class="progress-bar bg-warning" role="progressbar" style="width: 0%"></div>
                </div>
                <div class="d-flex justify-content-between">
                    <span class="text-muted">Used:</span>
                    <span id="disk-used" class="text-light">0 GB</span>
                </div>
                <div class="d-flex justify-content-between">
                    <span class="text-muted">Free:</span>
                    <span id="disk-free" class="text-light">0 GB</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Function to format bytes to human readable
function formatBytes(bytes, decimals = 2) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const dm = decimals < 0 ? 0 : decimals;
    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
}

// Function to update system info
function updateSystemInfo() {
    fetch('/api/system')
        .then(response => response.json())
        .then(data => {
            // CPU Info
            document.getElementById('cpu-percent').textContent = `${data.cpu.usage.toFixed(1)}%`;
            document.getElementById('cpu-usage').style.width = `${data.cpu.usage}%`;
            document.getElementById('cpu-cores').textContent = `${data.cpu.cores} cores, ${data.cpu.threads} threads`;
            document.getElementById('cpu-temp').textContent = `${data.cpu.temperature}°C`;
            
            // Memory Info
            document.getElementById('memory-percent').textContent = `${data.memory.percent.toFixed(1)}%`;
            document.getElementById('memory-usage').style.width = `${data.memory.percent}%`;
            document.getElementById('memory-used').textContent = formatBytes(data.memory.used);
            document.getElementById('memory-available').textContent = formatBytes(data.memory.available);           
            
            // Disk Info
            document.getElementById('disk-usage').style.width = `${data.disk.percent}%`;
            document.getElementById('disk-used').textContent = formatBytes(data.disk.used);
            document.getElementById('disk-free').textContent = formatBytes(data.disk.free);
        });
}

// Update immediately and every 2 seconds
updateSystemInfo();
setInterval(updateSystemInfo, 2000);
</script>
{% endblock %}